### **What is an Audit Log?**

An **audit log** in the context of Linux systems (and security in general) is a log that records events or actions that affect the system or applications. These logs are primarily used for tracking security-related activities, such as user logins, command executions, file access, and changes to system configurations.

In RHEL (and most Linux systems), **audit logs** are typically generated by the **Linux Audit Framework** (`auditd`), which is used to track events for security auditing and compliance purposes.

#### **Audit Log Contents**
Audit logs can include a variety of information, such as:
- **User actions**: Who accessed the system, when, and what actions were taken.
- **File accesses**: Who accessed specific files and whether they were modified, read, or written.
- **System calls**: Actions performed by processes, including file creation or deletion.
- **Authentication attempts**: Successful and failed login attempts.
- **Changes to system configurations**: Changes made to system files, groups, users, or services.

### **Audit Log Locations**

By default, audit logs in RHEL are stored in:

- **Audit Log File**: `/var/log/audit/audit.log`
- **System Logs**: `/var/log/messages` (may contain audit-related messages)

These logs provide detailed records of system events, especially related to security.

---

### **How to Enable and Configure Audit Logging in RHEL**

1. **Install the `audit` package** (if not already installed):

   ```bash
   sudo dnf install audit
   ```

2. **Start and enable the audit daemon (`auditd`)** to begin collecting audit logs:

   ```bash
   sudo systemctl start auditd
   sudo systemctl enable auditd
   ```

3. **Configure audit rules**: You can define specific events to be audited by modifying `/etc/audit/audit.rules` or using the `auditctl` command.

   For example, to log access to a specific file:

   ```bash
   auditctl -w /etc/passwd -p wa -k passwd_changes
   ```

   This command will monitor the `/etc/passwd` file for write (`w`) and attribute (`a`) changes and tag the events with the key `passwd_changes`.

---

### **Troubleshooting Audit Logs**

Audit logs can be helpful when diagnosing security issues, tracking unauthorized access, or auditing system changes. If you're troubleshooting using audit logs, here are some approaches and examples:

---

#### **1. Viewing the Audit Log**

To view the audit log, you can use:

```bash
sudo ausearch -f /var/log/audit/audit.log
```

You can also use the `ausearch` command with specific options to search for particular events.

- **Search for all user login events**:

  ```bash
  sudo ausearch -m USER_LOGIN
  ```

- **Search for file access events related to a specific file**:

  ```bash
  sudo ausearch -f /etc/passwd
  ```

- **Search for events related to a specific user**:

  ```bash
  sudo ausearch -ua username
  ```

- **Search for events by event type** (e.g., to see command executions):

  ```bash
  sudo ausearch -m EXECVE
  ```

---

#### **2. Audit Log Example: Failed SSH Login Attempts**

One common troubleshooting scenario is identifying failed login attempts. If an attacker is trying to brute-force login into the system, you may want to look at the audit log for failed login events.

- **To search for failed login attempts** (such as through SSH):

  ```bash
  sudo ausearch -m USER_AUTH -sv no
  ```

  This will search for all user authentication events where the attempt was unsuccessful (`-sv no`).

  **Example output:**

  ```
  type=USER_AUTH msg=audit(1614709123.892:1375): user pid=24889 uid=0 auid=0 ses=2 msg='op=login id=uid=0 exe="/usr/sbin/sshd" hostname=example.com addr=192.168.1.100 terminal=ssh res=failed'
  ```

  **Explanation:**
  - **`op=login`**: The event type is a login attempt.
  - **`res=failed`**: The authentication failed.
  - **`addr=192.168.1.100`**: The source IP address of the failed login attempt.
  - **`exe="/usr/sbin/sshd"`**: The process that generated the event (SSH login).

---

#### **3. Audit Log Example: Monitoring File Access**

If you are concerned about unauthorized access to sensitive files (like `/etc/shadow`), you can check for file access events.

- **To search for file access events involving `/etc/shadow`**:

  ```bash
  sudo ausearch -f /etc/shadow
  ```

  **Example output:**

  ```
  type=SYSCALL msg=audit(1614710232.475:1426): arch=c000003e syscall=59 success=yes exit=0 a0=7fff3db779f0 a1=7fff3db77a40 a2=7fff3db77a00 a3=7fff3db77960 items=2 ppid=23598 pid=24952 auid=1000 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=2 comm="vim" exe="/usr/bin/vim" key="shadow_access"
  ```

  **Explanation:**
  - **`comm="vim"`**: The command that was used to access the file.
  - **`exe="/usr/bin/vim"`**: The executable used (in this case, `vim`).
  - **`key="shadow_access"`**: The custom key used when monitoring the file.
  - **`syscall=59`**: Indicates the specific system call used (in this case, a file open).

---

#### **4. Monitoring Privileged Commands**

If you are concerned about privileged commands being executed by users, you can set up rules to monitor command executions. For example, monitoring `sudo` commands:

- **To track `sudo` commands being executed**:

  ```bash
  auditctl -a always,exit -F arch=b64 -S execve -k sudo_commands
  ```

- **To search for commands executed with `sudo`**:

  ```bash
  sudo ausearch -k sudo_commands
  ```

  **Example output:**

  ```
  type=EXECVE msg=audit(1614711890.253:2173): argc=3 a0="sudo" a1="/bin/ls" a2="/etc/shadow"
  ```

  **Explanation:**
  - **`sudo`**: The command that invoked the elevated privilege.
  - **`/bin/ls`**: The command being executed with elevated privileges (`ls`).
  - **`/etc/shadow`**: The argument passed to the command (in this case, the file being listed).

---

### **5. Troubleshooting: Audit Log Storage and Rotation Issues**

Sometimes audit logs can grow large and require proper rotation or retention strategies. You can configure the audit log rotation settings in the `/etc/audit/auditd.conf` file.

- **Set up log rotation**: Ensure that the system is rotating audit logs properly to avoid disk space issues. Look for parameters like:

  ```bash
  max_log_file = 8
  max_log_file_action = ROTATE
  ```

- **Log Rotation Command**:

  ```bash
  sudo logrotate /etc/audit/auditd.conf
  ```

---

### **Conclusion**

Audit logs are crucial for monitoring and maintaining security in Linux systems, especially in production environments. They help you track system activities, identify unauthorized access, monitor sensitive file accesses, and troubleshoot security incidents. You can utilize tools like `ausearch` and `auditctl` to configure and analyze the logs effectively.

In case of troubleshooting:
- Start by checking the `/var/log/audit/audit.log` file or using `ausearch`.
- Look for failed login attempts, sensitive file access, and privileged command executions.
- Use `journalctl` for system logs and configure audit log retention to avoid storage issues.

